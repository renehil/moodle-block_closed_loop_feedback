{"version":3,"sources":["../src/script_closed_loop_support.js"],"names":["modalObj","courseidClicked","moduleidClicked","actualCounter","renderResponse","courseid","moduleid","Ajax","call","methodname","args","done","values","setBody","modalbody","size","setLarge","setSmall","Notification","exception","Error","fail","loadModalDialog","Str","get_string","then","title","ModalFactory","create","type","types","CANCEL","body","large","scrollable","modal","setButtonText","show","getRoot","on","processSubmit","ModalEvents","hidden","destroy","writeRequest","catch","e","preventDefault","value","document","getElementById","length","style","cmid","counter","explanation","explanationWasSend","thanks","innerHTML","nodes","getElementsByTagName","i","disabled","buttonClickEvent","event","stringIDs","target","getAttribute","replace","splitString","split","renderButtonTemplate","element","data","Templates","renderForPromise","html","js","res","prependNodeContents","addEventListener","init","requestButtons","Object","tooltip"],"mappings":"ujBAyBA,OACA,OACA,OACA,OACA,OACA,O,yiBAIIA,CAAAA,C,CACAC,C,CACAC,C,CACAC,C,CAaEC,CAAc,CAAG,SAACC,CAAD,CAAWC,CAAX,CAAwB,CAE3CC,CAAI,CAACC,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,0CADL,CAEPC,IAAI,CAAE,CACFL,QAAQ,CAAEA,CADR,CAEFC,QAAQ,CAAEA,CAFR,CAFC,CAKPK,IAAI,CAAE,cAASC,CAAT,CAAiB,CACf,GAAgB,IAAb,GAAAZ,CAAH,CAAqB,CACjBA,CAAQ,CAACa,OAAT,CAAiBD,CAAM,CAACE,SAAxB,EACA,GAAGF,CAAM,CAACG,IAAV,CAAe,CACXf,CAAQ,CAACgB,QAAT,EACH,CAFD,IAGI,CACAhB,CAAQ,CAACiB,QAAT,EACH,CACJ,CARD,IASI,CACAC,CAAY,CAACC,SAAb,CAAuB,GAAIC,CAAAA,KAAJ,CAAU,kCAAV,CAAvB,CACH,CACJ,CAlBE,CAmBPC,IAAI,CAAEH,CAAY,CAACC,SAnBZ,CAAD,CAAV,CAqBH,C,CAMKG,CAAe,CAAG,UAAK,CACzBC,CAAG,CAACC,UAAJ,CAAe,eAAf,CAAgC,2BAAhC,EAA6DC,IAA7D,CAAkE,SAASC,CAAT,CAAgB,CAC9EC,CAAY,CAACC,MAAb,CAAoB,CAChBC,IAAI,CAAEF,CAAY,CAACG,KAAb,CAAmBC,MADT,CAEhBL,KAAK,CAAEA,CAFS,CAGhBM,IAAI,oFAHY,CAIhBC,KAAK,GAJW,CAKhBC,UAAU,GALM,CAApB,EAOKT,IAPL,CAOU,SAAAU,CAAK,CAAI,CACXA,CAAK,CAACC,aAAN,CAAoB,QAApB,CAA8B,OAA9B,EACAD,CAAK,CAACE,IAAN,GACArC,CAAQ,CAAGmC,CAAX,CACAA,CAAK,CAACG,OAAN,GAAgBC,EAAhB,CAAmB,OAAnB,CAA4B,mBAA5B,CAAiDC,CAAjD,EACAL,CAAK,CAACG,OAAN,GAAgBC,EAAhB,CAAmBE,CAAW,CAACC,MAA/B,CAAuC,UAAU,CAE7CP,CAAK,CAACQ,OAAN,EACH,CAHD,EAIAC,CAAY,EACnB,CAjBD,CAkBH,CAnBD,EAmBGC,KAnBH,CAmBS,UAAW,CACZ3B,CAAY,CAACC,SAAb,CAAuB,GAAIC,CAAAA,KAAJ,CAAU,4BAAV,CAAvB,CACP,CArBD,CAsBH,C,CAOKoB,CAAa,CAAG,SAACM,CAAD,CAAM,CACxBA,CAAC,CAACC,cAAF,GACA,GAAIC,CAAAA,CAAK,CAAGC,QAAQ,CAACC,cAAT,CAAwB,yBAAxB,EAAmDF,KAA/D,CACA,GAAoB,CAAjB,GAAAA,CAAK,CAACG,MAAT,CAAsB,CAClBF,QAAQ,CAACC,cAAT,CAAwB,4BAAxB,EAAsDE,KAAtD,CAA8D,kBACjE,CAFD,IAIA,CACIH,QAAQ,CAACC,cAAT,CAAwB,yBAAxB,EAAmDE,KAAnD,CAA2D,kBAA3D,CACA7C,CAAI,CAACC,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,6CADL,CAEPC,IAAI,CAAE,CACFL,QAAQ,CAAEJ,CADR,CAEFoD,IAAI,CAAEnD,CAFJ,CAGFoD,OAAO,CAAEnD,CAHP,CAIFoD,WAAW,CAAEP,CAJX,CAFC,CAOPrC,IAAI,CAAE6C,CAAkB,EAPjB,CAQPnC,IAAI,CAAEH,CAAY,CAACC,SARZ,CAAD,CAAV,CAUH,CAGJ,C,CAGKqC,CAAkB,CAAG,UAAK,CAC5BjC,CAAG,CAACC,UAAJ,CAAe,WAAf,CAA4B,2BAA5B,EAAyDC,IAAzD,CAA8D,SAASgC,CAAT,CAAiB,CACvER,QAAQ,CAACC,cAAT,CAAwB,uBAAxB,EAAiDQ,SAAjD,CAA6D,MAAOD,CAAP,CAAe,KAA5E,CAEA,OADIE,CAAAA,CAAK,CAAGV,QAAQ,CAACC,cAAT,CAAwB,6BAAxB,EAAuDU,oBAAvD,CAA4E,GAA5E,CACZ,CAAQC,CAAC,CAAG,CAAZ,CAAeA,CAAC,CAAGF,CAAK,CAACR,MAAzB,CAAiCU,CAAC,EAAlC,CAAqC,CACjCF,CAAK,CAACE,CAAD,CAAL,CAASC,QAAT,GACH,CACR,CAND,EAMGjB,KANH,CAMS,UAAW,CAChB3B,CAAY,CAACC,SAAb,CAAuB,GAAIC,CAAAA,KAAJ,CAAU,4BAAV,CAAvB,CACH,CARD,CASH,C,CAEKwB,CAAY,CAAG,UAAK,CAClBrC,CAAI,CAACC,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,0CADL,CAEPC,IAAI,CAAE,CACFL,QAAQ,CAAEJ,CADR,CAEFoD,IAAI,CAAEnD,CAFJ,CAFC,CAKPS,IAAI,CAAE,cAAS2C,CAAT,CAAkB,CAChBnD,CAAa,CAAGmD,CAAhB,CACAlD,CAAc,CAACH,CAAD,CAAkBC,CAAlB,CACjB,CARE,CASPmB,IAAI,CAAEH,CAAY,CAACC,SATZ,CAAD,CAAV,CAWP,C,CAKK4C,CAAgB,CAAG,SAACC,CAAD,CAAU,IAE3BC,CAAAA,CAAS,CAAGD,CAAK,CAACE,MAAN,CAAaC,YAAb,CAA0B,IAA1B,EAAgCC,OAAhC,CAAwC,aAAxC,CAAsD,EAAtD,CAFe,CAG3BC,CAAW,CAAGJ,CAAS,CAACK,KAAV,CAAgB,GAAhB,CAHa,CAI/BrE,CAAe,CAAGoE,CAAW,CAAC,CAAD,CAA7B,CACAnE,CAAe,CAAGmE,CAAW,CAAC,CAAD,CAA7B,CACA/C,CAAe,EAClB,C,CAQKiD,CAAoB,CAAG,SAACC,CAAD,CAAUC,CAAV,CAAmB,CAExCC,CAAS,CAACC,gBAAV,CAA2B,sCAA3B,CAAmEF,CAAnE,EACShD,IADT,CACc,WAAgB,IAAdmD,CAAAA,CAAc,GAAdA,IAAc,CAARC,CAAQ,GAARA,EAAQ,CACtBC,CAAG,CAAGJ,CAAS,CAACK,mBAAV,CAA8BP,CAA9B,CAAuCI,CAAvC,CAA6CC,CAA7C,CADgB,CAE1B,GAAW,IAAR,GAAAC,CAAH,CAAgB,CACZA,CAAG,CAAC,CAAD,CAAH,CAAOE,gBAAP,CAAwB,OAAxB,CAAiC,SAAClC,CAAD,CAAO,CAACiB,CAAgB,CAACjB,CAAD,CAAK,CAA9D,CACH,CACA,CANL,EAMOD,KANP,EAQP,C,QAMmB,QAAPoC,CAAAA,IAAO,CAACC,CAAD,CAAoB,CAGpC,IAAI,GAAIrB,CAAAA,CAAC,CAAG,CAAZ,CAAeA,CAAC,CAAGsB,MAAM,CAACvE,MAAP,CAAcsE,CAAd,EAA8B/B,MAAjD,CAAyDU,CAAC,EAA1D,CAA6D,IACnDY,CAAAA,CAAI,CAAG,CACTpE,QAAQ,CAAE8E,MAAM,CAACvE,MAAP,CAAcsE,CAAd,EAA8BrB,CAA9B,EAAiCxD,QADlC,CAETC,QAAQ,CAAE6E,MAAM,CAACvE,MAAP,CAAcsE,CAAd,EAA8BrB,CAA9B,EAAiCvD,QAFlC,CAGT8E,OAAO,CAAED,MAAM,CAACvE,MAAP,CAAcsE,CAAd,EAA8BrB,CAA9B,EAAiCuB,OAHjC,CAD4C,CAerDZ,CAAO,CAAGvB,QAAQ,CAACC,cAAT,CAAwB,UAAYuB,CAAI,CAACnE,QAAzC,CAf2C,CAgBzD,GAAGkE,CAAH,CACA,CACID,CAAoB,CAACC,CAAD,CAAUC,CAAV,CACvB,CACJ,CAGJ,C","sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manage buttons and response for closed loop support\n * @copyright  2022 Rene Hilgemann\n * @author     Rene Hilgemann <rene.hilgemann@stud.uni-due.de>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\n\n\nimport * as Templates from 'core/templates';\nimport * as Notification from 'core/notification';\nimport * as Ajax from 'core/ajax';\nimport * as ModalFactory from 'core/modal_factory';\nimport * as ModalEvents from 'core/modal_events';\nimport * as Str from 'core/str';\n\n\n//The modal dialog object\nvar modalObj;\nvar courseidClicked;\nvar moduleidClicked;\nvar actualCounter;\n//var isMandatory;\n\n//Spinner for time during loading\nconst spinner = '<p class=\"text-center\">'\n        + '<i class=\"fa fa-spinner fa-pulse fa-2x fa-fw\"></i>'\n        + '</p>';\n\n/**\n * Ask for response and render in div element inside of block\n * @param {Integer} courseid\n * @param {Integer} moduleid\n */\nconst renderResponse = (courseid, moduleid) => {\n\n    Ajax.call([{\n        methodname: 'block_closed_loop_support_get_modal_body',\n        args: {\n            courseid: courseid,\n            moduleid: moduleid},\n        done: function(values) {\n                if(modalObj !== null){\n                    modalObj.setBody(values.modalbody);\n                    if(values.size){\n                        modalObj.setLarge();\n                    }\n                    else{\n                        modalObj.setSmall();\n                    }\n                }\n                else{\n                    Notification.exception(new Error('Failed to load modal dialog base'));\n                }\n            },\n        fail: Notification.exception\n      }]);\n};\n\n/**\n *\n * @returns {undefined}\n */\nconst loadModalDialog = () =>{\n    Str.get_string('responseTitle', 'block_closed_loop_support').then(function(title) {\n        ModalFactory.create({\n            type: ModalFactory.types.CANCEL,\n            title: title,\n            body: spinner,\n            large: false,\n            scrollable: true\n            })\n            .then(modal => {\n                modal.setButtonText('cancel', 'Close');\n                modal.show();\n                modalObj = modal;\n                modal.getRoot().on('click', '#id_submit_button', processSubmit);\n                modal.getRoot().on(ModalEvents.hidden, function(){\n                    //Destroy and not only hide\n                    modal.destroy();\n                });\n                writeRequest();\n        });\n    }).catch(function() {\n            Notification.exception(new Error('Failed to load HeaderTitle'));\n    });\n};\n\n/**\n *\n * @param {Object} e\n * @returns {undefined}\n */\nconst processSubmit = (e) =>{\n    e.preventDefault();\n    var value = document.getElementById('id_explanation_textarea').value;\n    if(value.length === 0){\n        document.getElementById('no_empty_explanation_label').style = 'display: visible';\n    }\n    else\n    {\n        document.getElementById('content_modal_body_elem').style = 'display: visible';\n        Ajax.call([{\n            methodname: 'block_closed_loop_support_write_explanation',\n            args: {\n                courseid: courseidClicked,\n                cmid: moduleidClicked,\n                counter: actualCounter,\n                explanation: value},\n            done: explanationWasSend(),\n            fail: Notification.exception\n        }]);\n    }\n\n\n};\n\n\nconst explanationWasSend = () =>{\n    Str.get_string('expThanks', 'block_closed_loop_support').then(function(thanks) {\n            document.getElementById('explain_heading_label').innerHTML = \"<b>\"+ thanks +\"<b>\";\n            var nodes = document.getElementById(\"explanation_modal_body_elem\").getElementsByTagName('*');\n            for(var i = 0; i < nodes.length; i++){\n                nodes[i].disabled = true;\n            }\n    }).catch(function() {\n        Notification.exception(new Error('Failed to load HeaderTitle'));\n    });\n};\n\nconst writeRequest = () =>{\n        Ajax.call([{\n            methodname: 'block_closed_loop_support_write_requests',\n            args: {\n                courseid: courseidClicked,\n                cmid: moduleidClicked},\n            done: function(counter) {\n                    actualCounter = counter;\n                    renderResponse(courseidClicked, moduleidClicked);\n                },\n            fail: Notification.exception\n        }]);\n};\n/**\n * Click event\n * @param {Var} event\n */\nconst buttonClickEvent = (event) =>{\n\n    var stringIDs = event.target.getAttribute('id').replace('loopButton_','');\n    var splitString = stringIDs.split('_');\n    courseidClicked = splitString[0];\n    moduleidClicked = splitString[1];\n    loadModalDialog();\n};\n\n\n/**\n * Insert element\n * @param {Var} element\n * @param {Var} data\n */\nconst renderButtonTemplate = (element, data) => {\n\n        Templates.renderForPromise('block_closed_loop_support/loopButton', data)\n                .then(({html, js}) => {\n            var res = Templates.prependNodeContents(element, html, js);\n            if(res !== null){\n                res[0].addEventListener('click', (e) => {buttonClickEvent(e);});\n            }\n            }).catch();\n\n};\n\n/**\n * Setting up\n * @param {Array} requestButtons\n */\nexport const init = (requestButtons) => {\n\n\n    for(let i = 0; i < Object.values(requestButtons).length; i++){\n        const data = {\n            courseid: Object.values(requestButtons)[i].courseid,\n            moduleid: Object.values(requestButtons)[i].moduleid,\n            tooltip: Object.values(requestButtons)[i].tooltip\n        };\n\n        /**\n        General idea for placing button into 'module-<X>'\n        and mouseover effect\n        adapted from moodle plugin 'Point of view - Feedback'\n        developed by: Quentin Fombaron and Astor Bizard\n        https://moodle.org/plugins/block_point_view\n        Release v1.6.3\n        */\n        var element = document.getElementById('module-' + data.moduleid);\n        if(element)\n        {\n            renderButtonTemplate(element, data);\n        }\n    }\n\n\n};\n\n"],"file":"script_closed_loop_support.min.js"}