{"version":3,"sources":["../src/script_closed_loop_support.js"],"names":["renderResponse","courseid","moduleid","Ajax","call","methodname","args","done","responseContent","ModalFactory","create","type","types","DEFAULT","title","body","content","footer","large","scrollable","then","modal","show","fail","Notification","exception","buttonClickEvent","element","stringIDs","target","getAttribute","replace","splitString","split","cmid","renderTemplate","data","Templates","renderForPromise","html","js","res","prependNodeContents","addEventListener","e","catch","init","requestButtons","i","Object","values","length","document","getElementById"],"mappings":"ohBAqBA,OACA,OACA,OACA,O,yiBAQMA,CAAAA,CAAc,CAAG,SAACC,CAAD,CAAWC,CAAX,CAAwB,CAC3CC,CAAI,CAACC,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,gDADL,CAEPC,IAAI,CAAE,CACFL,QAAQ,CAAEA,CADR,CAEFC,QAAQ,CAAEA,CAFR,CAFC,CAKPK,IAAI,CAAE,cAASC,CAAT,CAA0B,CACxBC,CAAY,CAACC,MAAb,CAAoB,CAChBC,IAAI,CAAEF,CAAY,CAACG,KAAb,CAAmBC,OADT,CAEhBC,KAAK,CAAEN,CAAe,CAACM,KAFP,CAGhBC,IAAI,CAAEP,CAAe,CAACQ,OAHN,CAIhBC,MAAM,CAAE,EAJQ,CAKhBC,KAAK,GALW,CAMhBC,UAAU,GANM,CAApB,EAQCC,IARD,CAQM,SAAAC,CAAK,CAAI,CACXA,CAAK,CAACC,IAAN,GACA,MAAOD,CAAAA,CACV,CAXD,CAiBH,CAvBE,CAwBPE,IAAI,CAAEC,CAAY,CAACC,SAxBZ,CAAD,CAAV,CA0BH,C,CAMKC,CAAgB,CAAG,SAACC,CAAD,CAAY,IAE7BC,CAAAA,CAAS,CAAGD,CAAO,CAACE,MAAR,CAAeC,YAAf,CAA4B,IAA5B,EAAkCC,OAAlC,CAA0C,aAA1C,CAAwD,EAAxD,CAFiB,CAG7BC,CAAW,CAAGJ,CAAS,CAACK,KAAV,CAAgB,GAAhB,CAHe,CAIhC9B,CAAI,CAACC,IAAL,CAAU,CAAC,CACRC,UAAU,CAAE,0CADJ,CAERC,IAAI,CAAE,CACFL,QAAQ,CAAE+B,CAAW,CAAC,CAAD,CADnB,CAEFE,IAAI,CAAEF,CAAW,CAAC,CAAD,CAFf,CAFE,CAKRzB,IAAI,CAAE,eAAW,CACTP,CAAc,CAACgC,CAAW,CAAC,CAAD,CAAZ,CAAiBA,CAAW,CAAC,CAAD,CAA5B,CACjB,CAPG,CAQRT,IAAI,CAAEC,CAAY,CAACC,SARX,CAAD,CAAV,CAUJ,C,CAQKU,CAAc,CAAG,SAACR,CAAD,CAAUS,CAAV,CAAmB,CAElCC,CAAS,CAACC,gBAAV,CAA2B,sCAA3B,CAAmEF,CAAnE,EACShB,IADT,CACc,WAAgB,IAAdmB,CAAAA,CAAc,GAAdA,IAAc,CAARC,CAAQ,GAARA,EAAQ,CACtBC,CAAG,CAAGJ,CAAS,CAACK,mBAAV,CAA8Bf,CAA9B,CAAuCY,CAAvC,CAA6CC,CAA7C,CADgB,CAE1B,GAAW,IAAR,GAAAC,CAAH,CAAgB,CACZA,CAAG,CAAC,CAAD,CAAH,CAAOE,gBAAP,CAAwB,OAAxB,CAAiC,SAACC,CAAD,CAAO,CAAClB,CAAgB,CAACkB,CAAD,CAAK,CAA9D,CACH,CACA,CANL,EAMOC,KANP,EAQP,C,QAMmB,QAAPC,CAAAA,IAAO,CAACC,CAAD,CAAoB,CAEpC,IAAI,GAAIC,CAAAA,CAAC,CAAG,CAAZ,CAAeA,CAAC,CAAGC,MAAM,CAACC,MAAP,CAAcH,CAAd,EAA8BI,MAAjD,CAAyDH,CAAC,EAA1D,CAA6D,IACnDZ,CAAAA,CAAI,CAAG,CACTnC,QAAQ,CAAEgD,MAAM,CAACC,MAAP,CAAcH,CAAd,EAA8BC,CAA9B,EAAiC/C,QADlC,CAETC,QAAQ,CAAE+C,MAAM,CAACC,MAAP,CAAcH,CAAd,EAA8BC,CAA9B,EAAiC9C,QAFlC,CAD4C,CAMrDyB,CAAO,CAAGyB,QAAQ,CAACC,cAAT,CAAwB,UAAYjB,CAAI,CAAClC,QAAzC,CAN2C,CAOzD,GAAGyB,CAAH,CACA,CACIQ,CAAc,CAACR,CAAD,CAAUS,CAAV,CACjB,CACJ,CAEJ,C","sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manage buttons and response for closed loop support\n * @copyright  2022 Rene Hilgemann\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as Templates from 'core/templates';\nimport * as Notification from 'core/notification';\nimport * as Ajax from 'core/ajax';\nimport * as ModalFactory from 'core/modal_factory';\n\n\n/**\n * Ask for response and render in div element inside of block\n * @param {Integer} courseid\n * @param {Integer} moduleid\n */\nconst renderResponse = (courseid, moduleid) => {\n    Ajax.call([{\n        methodname: 'block_closed_loop_support_get_response_content',\n        args: {\n            courseid: courseid,\n            moduleid: moduleid},\n        done: function(responseContent) {\n                ModalFactory.create({\n                    type: ModalFactory.types.DEFAULT,\n                    title: responseContent.title,\n                    body: responseContent.content,\n                    footer: '',\n                    large: true,\n                    scrollable: false\n                })\n                .then(modal => {\n                    modal.show();\n                    return modal;\n                });\n\n                    /*document.getElementById(\"response_area\").innerHTML = responseContent;\n                    Notification.addNotification({message:\n                    \"Your help has been processed and further information is shown in the block 'Closed loop support'\",\n                    type: \"info\"});*/\n            },\n        fail: Notification.exception\n      }]);\n};\n\n/**\n * Click event\n * @param {Var} element\n */\nconst buttonClickEvent = (element) =>{\n\n    var stringIDs = element.target.getAttribute('id').replace('loopButton_','');\n    var splitString = stringIDs.split('_');\n     Ajax.call([{\n        methodname: 'block_closed_loop_support_write_requests',\n        args: {\n            courseid: splitString[0],\n            cmid: splitString[1]},\n        done: function() {\n                renderResponse(splitString[0], splitString[1]);\n            },\n        fail: Notification.exception\n      }]);\n};\n\n\n/**\n * Insert element\n * @param {Var} element\n * @param {Var} data\n */\nconst renderTemplate = (element, data) => {\n\n        Templates.renderForPromise('block_closed_loop_support/loopButton', data)\n                .then(({html, js}) => {\n            var res = Templates.prependNodeContents(element, html, js);\n            if(res !== null){\n                res[0].addEventListener('click', (e) => {buttonClickEvent(e);});\n            }\n            }).catch();\n\n};\n\n/**\n * Setting up\n * @param {Array} requestButtons\n */\nexport const init = (requestButtons) => {\n\n    for(let i = 0; i < Object.values(requestButtons).length; i++){\n        const data = {\n            courseid: Object.values(requestButtons)[i].courseid,\n            moduleid: Object.values(requestButtons)[i].moduleid\n        };\n\n        var element = document.getElementById('module-' + data.moduleid);\n        if(element)\n        {\n            renderTemplate(element, data);\n        }\n    }\n\n};\n\n"],"file":"script_closed_loop_support.min.js"}